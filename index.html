<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Zadań</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/coffynerd/task_app_admin/main/public/favicon.png">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f4f4f4;
        }
        .nav {
            background-color: #333;
            overflow: hidden;
            border-bottom: 3px solid #555;
        }
        .nav a {
            float: left;
            display: block;
            color: white;
            text-align: center;
            padding: 14px 20px;
            text-decoration: none;
            font-size: 16px;
            cursor: pointer;
        }
        .nav a:hover {
            background-color: #ddd;
            color: black;
        }
        .content {
            padding: 20px 40px;
        }
        h2, h3 {
            color: #333;
        }
        .task {
            padding: 12px;
            margin-bottom: 8px;
            border-left: 5px solid #007bff;
            background-color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .task.done {
            background-color: #e9ecef;
            border-left: 5px solid #28a745;
            text-decoration: line-through;
            color: #6c757d;
        }
        #taskForm {
            margin-top: 20px;
            margin-bottom: 30px;
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #taskForm input {
            padding: 10px;
            margin-right: 10px;
            width: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            margin-left: 10px;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            color: white;
            background-color: #007bff;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .task button {
             background-color: #6c757d;
        }
         .task button:hover {
             background-color: #5a6268;
        }
    </style>
</head>
<body>

<div class="nav">
    <a onclick="showPage('tasks')">Lista zadań</a>
    <a onclick="showPage('order')">Do zamówienia</a>
    <a onclick="showPage('schedule')">Grafik</a>
</div>

<div id="tasks" class="content">
    <h2>Panel Administratora</h2>
    <form id="taskForm">
        <h3>Dodaj nowe zadanie</h3>
        <input type="text" id="taskInput" placeholder="Treść zadania" required>
        <input type="text" id="assigneeInput" placeholder="Pracownicy (oddzieleni średnikiem)">
        <button type="submit">Dodaj</button>
    </form>

    <h3>Aktywna lista zadań</h3>
    <div id="taskList">Ładowanie...</div>

    <h3>Zadania ukryte</h3>
    <div id="hiddenTaskList"></div>
</div>

<div id="order" class="content" style="display:none">
    <h2>Do zamówienia</h2>
    <p>Strona w budowie</p>
</div>

<div id="schedule" class="content" style="display:none">
    <h2>Grafik</h2>
    <p>Strona w budowie</p>
</div>


<script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabaseUrl = 'https://ugznhwthaztruazsjbhu.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVnem5od3RoYXp0cnVhenNqYmh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0NjU4NjAsImV4cCI6MjA2NDA0MTg2MH0.MlBkk-oKSRW7CaUiFf3Edo0KXamVlLaZfLuxGcWL4yU';
    const supabase = createClient(supabaseUrl, supabaseKey);

    const taskList = document.getElementById('taskList');
    const hiddenTaskList = document.getElementById('hiddenTaskList');
    const taskForm = document.getElementById('taskForm');

    async function renderTasks() {
        const { data: tasks, error } = await supabase.from('tasks').select('*').order('created_at', { ascending: false });
        
        taskList.innerHTML = '';
        hiddenTaskList.innerHTML = '';

        if (error) {
            console.error('Błąd ładowania zadań:', error);
            taskList.textContent = 'Wystąpił błąd podczas ładowania zadań.';
            return;
        }

        if (tasks.length === 0) {
            taskList.textContent = 'Brak zadań do wyświetlenia.';
        }

        tasks.forEach(task => {
            const div = document.createElement('div');
            div.classList.add('task');
            if (task.done) div.classList.add('done');

            const label = document.createElement('label');
            label.textContent = `${task.content} (Przypisani: ${task.assignees || 'brak'})`;
            
            const buttonsDiv = document.createElement('div');

            const editBtn = document.createElement('button');
            editBtn.textContent = 'Edytuj';
            editBtn.onclick = async () => {
                const newContent = prompt('Nowa treść zadania:', task.content);
                const newAssignees = prompt('Nowi przypisani (oddzieleni średnikiem):', task.assignees || '');
                if (newContent !== null && newAssignees !== null) {
                    await supabase.from('tasks').update({ content: newContent, assignees: newAssignees }).eq('id', task.id);
                    renderTasks();
                }
            };

            const toggleBtn = document.createElement('button');
            toggleBtn.textContent = task.visible === false ? 'Odkryj' : 'Ukryj';
            toggleBtn.onclick = async () => {
                await supabase.from('tasks').update({ visible: !task.visible }).eq('id', task.id);
                renderTasks();
            };
            
            buttonsDiv.appendChild(editBtn);
            buttonsDiv.appendChild(toggleBtn);
            div.appendChild(label);
            div.appendChild(buttonsDiv);

            if (task.visible === false) {
                hiddenTaskList.appendChild(div);
            } else {
                taskList.appendChild(div);
            }
        });
    }

    taskForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const content = document.getElementById('taskInput').value.trim();
        const assignees = document.getElementById('assigneeInput').value.trim();
        if (!content) return alert('Wpisz treść zadania.');
        await supabase.from('tasks').insert([{ content, assignees, done: false, visible: true }]);
        taskForm.reset();
        renderTasks();
    });

    renderTasks();
</script>

<script>
    function showPage(pageId) {
        document.querySelectorAll('.content').forEach(page => {
            page.style.display = 'none';
        });
        document.getElementById(pageId).style.display = 'block';
    }
</script>

</body>
</html>
