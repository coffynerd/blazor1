<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administratora</title>
    <link rel="icon" href="https://raw.githubusercontent.com/coffynerd/task_app_admin/main/public/favicon.png" type="image/png">

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        const supabaseUrl = 'https://ugznhwthaztruazsjbhu.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVnem5od3RoYXp0cnVhenNqYmh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0NjU4NjAsImV4cCI6MjA2NDA0MTg2MH0.MlBkk-oKSRW7CaUiFf3Edo0KXamVlLaZfLuxGcWL4yU';
        const supabase = createClient(supabaseUrl, supabaseKey);

        const taskList = document.getElementById('taskList');
        const hiddenTaskList = document.getElementById('hiddenTaskList');
        const taskForm = document.getElementById('taskForm');

        async function renderTasks() {
            const { data: tasks, error } = await supabase.from('tasks').select('*');
            taskList.innerHTML = '';
            hiddenTaskList.innerHTML = '';
            if (error) {
                console.error("Błąd Supabase:", error);
                taskList.textContent = 'Błąd ładowania zadań.';
                return;
            }

            tasks.forEach(task => {
                const div = document.createElement('div');
                div.classList.add('task');
                if (task.done) div.classList.add('done');

                const label = document.createElement('label');
                label.textContent = `${task.content} (Przypisani: ${task.assignees || 'brak'})`;

                const buttonsDiv = document.createElement('div');

                const editBtn = document.createElement('button');
                editBtn.textContent = 'Edytuj';
                editBtn.onclick = async () => {
                    const newContent = prompt('Nowa treść zadania:', task.content);
                    const newAssignees = prompt('Nowi przypisani (oddzieleni średnikiem):', task.assignees || '');
                    if (newContent !== null && newAssignees !== null) {
                        await supabase.from('tasks').update({ content: newContent, assignees: newAssignees }).eq('id', task.id);
                        renderTasks();
                    }
                };

                const toggleBtn = document.createElement('button');
                toggleBtn.textContent = task.visible === false ? 'Odkryj' : 'Ukryj';
                toggleBtn.onclick = async () => {
                    await supabase.from('tasks').update({ visible: !task.visible }).eq('id', task.id);
                    renderTasks();
                };

                buttonsDiv.appendChild(editBtn);
                buttonsDiv.appendChild(toggleBtn);
                div.appendChild(label);
                div.appendChild(buttonsDiv);

                (task.visible === false ? hiddenTaskList : taskList).appendChild(div);
            });
        }

        taskForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const content = document.getElementById('taskInput').value.trim();
            const assignees = document.getElementById('assigneeInput').value.trim();
            if (!content) return alert('Wpisz treść zadania.');
            await supabase.from('tasks').insert([{ content, assignees, done: false, visible: true }]);
            taskForm.reset();
            renderTasks();
        });

        renderTasks();
    </script>

    <style>
        body { font-family: Arial, sans-serif; margin: 0; }
        .nav { background-color: #333; overflow: hidden; padding: 0 20px; }
        .nav a {
            float: left;
            display: block;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
            cursor: pointer;
        }
        .nav a:hover { background-color: #ddd; color: black; }
        .content { padding: 20px 30px; }
        .task {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .task.done { background-color: #ffcccc; }
        form { margin-top: 20px; }
        button { margin-left: 10px; }
    </style>
</head>
<body>

<div class="nav">
    <a onclick="showPage('tasks')">Lista zadań</a>
    <a onclick="showPage('order')">Do zamówienia</a>
    <a onclick="showPage('schedule')">Grafik</a>
    <a href="https://coffynerd.github.io/task_app" target="_blank">Panel użytkownika</a>
</div>

<div id="tasks" class="content">
    <h2>Panel Administratora</h2>
    <form id="taskForm">
        <h3>Dodaj zadanie</h3>
        <input type="text" id="taskInput" placeholder="Treść zadania" required>
        <input type="text" id="assigneeInput" placeholder="Pracownicy (oddzieleni średnikiem)">
        <button type="submit">Dodaj</button>
    </form>
    <h3>Lista zadań</h3>
    <div id="taskList">Ładowanie...</div>
    <h3>Zadania ukryte</h3>
    <div id="hiddenTaskList"></div>
</div>

<div id="order" class="content" style="display: none;">
    <h2>Do zamówienia</h2>
    <p>Strona w budowie</p>
</div>

<div id="schedule" class="content" style="display: none;">
    <h2>Grafik</h2>
    <p>Strona w budowie</p>
</div>


<script>
    function showPage(pageId) {
        // Najpierw ukryj wszystkie kontenery
        document.querySelectorAll('.content').forEach(div => {
            div.style.display = 'none';
        });
        // A potem pokaż tylko ten wybrany
        document.getElementById(pageId).style.display = 'block';
    }
</script>

</body>
</html>
